#### 2025.02.19(Wed) Technical Interview 3

**사용자 인증 (Authentication)에 여러 방법이 있는데요~ (쿠키 기반 , 세션 기반 , JWT 기반 , OAuth 인증 방식등) 로그인 플로우를 비교하고, 각 장점과 단점을 분석했을때 보안성과 사용성을 고려한 가장 적합한 인증 방식에 관한 생각에 대해 기술해 주세요.**

전체 내용 => [블로그](https://yoolllog.tistory.com/27) 참조

쿠키 기반 , 세션 기반 , JWT 기반 , OAuth 인증 방식은 다음과 같이 크게 두 범주로 나눌 수 있다.

\- 쿠키 기반 인증, 세션 기반 인증, JWT 기반 인증:

- 인증 및 세션 관리에 중점을 둔다.
- 주로 사용자의 로그인 상태를 유지하고, 애플리케이션 내에서 사용자별로 상태를 관리하는 데 사용된다.

\- OAuth 인증:

- 권한 부여 프레임워크로, 제3자 애플리케이션이 사용자 데이터를 접근할 수 있도록 안전하게 권한을 부여하는 방법이다.
- 인증을 직접 다루지는 않고, 제3자 애플리케이션과의 연동에 사용된다.

즉, 쿠키 기반 , 세션 기반 , JWT 기반은 주로 인증 및 상태 관리에 사용되고, OAuth는 권한 부여 프레임워크이다. 이 두 범주는 동일한 선상에서 비교하는 것보다는 상호 보완적인 관계로 보는 것이 적절하다. 어떠한 방식이 가장 적합한 관계의 인증 방식인지는 각각의 특성을 비교해보고 알아보고자 한다.

### **쿠키**

HTTP 쿠키(웹 쿠키, 브라우저 쿠키)는 브라우저에 의해 사용자 컴퓨터에 저장되는 작은 텍스트( 실행 코드를 포함하지 않는 일반 텍스트 )파일이다. 브라우저는 그 데이터 조각들을 저장한 후, 동일한 서버에 재 요청 시 저장된 데이터를 함께 전송한다. 쿠키는 두 요청이 동일한 브라우저에서 들어왔는지 아닌지를 판단할 때 주로 사용한다.

쿠키는 아래와 같이 주로 세 가지 목적으로 사용된다.

- 세션 관리
- 개인화
- 트래킹

상태가 없는 HTTP 프로토콜에서 상태 정보를 기억시켜주기 때문에 이를 이용해 사용자의 로그인 상태를 유지할 수 있다.  과거엔 클라이언트 측에 정보를 저장할 때 주로 사용하곤 했으나 모든 요청마다 쿠키가 함께 전송되기 때문에 성능이 떨어지는 원인이 될 수 있다.

쿠키는 키 - 값의 한 쌍과 0개 이상의 속성으로 구성된다. 쿠키 는 키와 값을 통해 쿠키를 식별하고 정보를 담을 수 있다. 속성은 만료 기간이나 보안 사항등 쿠키의 동작과 범위를 설정하는데 사용된다.

\------

**쿠키의 장단점**

**장점 :**

- 상태 유지 : 로그인 상태나 사용자 설정 등 필요한 정보를 클라이언트에 저장해 지속적으로 유지할 수 있다.
- 간편성 : 별도의 복잡한 구현 없이 간단하게 사용할 수 있다.
- 지속성 : 만료 날짜나 최대 수명을 설정하면, 브라우저를 닫더라도 쿠키를 유지할 수 있다.
- 자동 전송 : 동일 도메인에 대한 모든 HTTP 요청마다 쿠키가 자동으로 전송되어, 서버에서 별도로 상태 정보를 관리할 필요가 없다.

**단점 :**

- 보안 취약점 : 쿠키는 클라이언트 측에 저장되므로, XSS 공격 등으로 탈취되거나 변조될 위험이 있다. 따라서 민감한 정보는 저장하지 않고, HttpOnly, Secure, SameSite 등의 속성을 설정해야 한다.
- 크기 제한 : 일반적으로 하나의 쿠키는 약 4KB 정도로 제한되며, 도메인당 저장할 수 있는 쿠키의 수에도 제한이 있다.
- 네트워크 부하 : 모든 HTTP 요청에 쿠키가 포함되어 전송되므로, 불필요한 트래픽이 발생할 수 있다.
- 사용자 설정 의존 : 사용자가 쿠키를 비활성화할 경우, 쿠키를 기반으로 한 인증이나 상태 유지가 제대로 작동하지 않는다.

### **세션**

사용자와 관련된 일련의 네트워크 HTTP 요청 및 응답 트랜잭션이다. 한 요청과 다음 요청 간에 상태 정보 유지를 위해 세션은 엑세스 권한 등과 같은 변수를 설정할 수 있는 기능을 제공하며 세션 기간 동안 사용자가 웹 애플리케이션과 수행하는 모든 상호 작용에 적용된다.

세션은 다음과 같이 동작한다.

1.  클라이언트가 서버에 로그인 요청을 한다.
2.  서버는 로그인 요청의 유효성을 확인하고 고유한 세션 ID를 생성하고, 사용자의 상태와 함께 세션 저장소에 저장한다.
3.  서버가 응답할 때 헤더에 쿠키를 추가하여 응답한다.
4.  이 쿠키는 보안 설정을 적용하여 클라이언트 측에서 보호되며 이후 클라이언트는 서버에 요청할 때 전달받은 쿠키를 자동으로 헤더에 추가하여 요청한다.
5.  서버는 요청 헤더의 세션 ID 값을 저장된 세션 저장소에서 찾아보고  유효한지 확인 후 요청을 처리하고 응답한다.

세션의 내용은 서버에 저장되기 때문에 계속하여 늘어날 경우 서버에 부하가 발생하고, 일정 시간이 지나거나, 로그아웃 등의 이벤트가 발생하면 세션은 만료되거나 삭제된다.

\------

**세션의 장단점**

**장점 :**

- 보안성: 세션 데이터는 서버 측에 저장되므로, 클라이언트에 민감한 정보를 그대로 노출시키지 않는다. 쿠키에는 세션 ID만 저장되기 때문에, 실제 데이터는 서버에 안전하게 보관된다.
- 데이터 용량: 쿠키와 달리 서버에 저장되기 때문에, 비교적 많은 양의 데이터를 관리할 수 있다.
- 상태 관리: 사용자의 인증 상태, 쇼핑 카트 정보, 사용자 선호 설정 등과 같은 다양한 상태 정보를 효율적으로 관리할 수 있다.

**단점 :**

- 서버 자원 소모: 사용자 수가 많아지면 서버에서 모든 사용자의 세션 정보를 저장하고 관리해야 하므로, 메모리나 데이터베이스 등의 자원 소모가 증가할 수 있다.
- 확장성 문제: 여러 서버가 분산되어 있는 환경에서는 세션 데이터를 공유하거나 동기화하는 추가 작업이 필요하다. 이를 위해 세션 클러스터링, Redis 등의 인메모리 데이터베이스를 사용하는 방법이 있다.
- 세션 만료 관리: 세션 타임아웃을 적절히 설정해야 하며, 사용자가 오랜 시간 활동하지 않을 경우 세션이 만료되어 다시 로그인이 필요할 수 있다.

### **JWT**

JSON 웹 토큰은 당사자 간에 정보를 JSON 객체로 안전하게 전송하기 위한 간결하고 독립적인 방법을 정의하는 개방형 표준(RFC 7519)이다. 이 정보는 디지털 서명이 되어 있어 신뢰할 수 있다.  공개/개인 키 쌍을 사용하여 서명된 토큰은 개인 키를 보유한 당사자만이 토큰에 서명했다는 것을 증명한다.

JWT는 일반적으로 다음과 같은 모양이다.

`xxxxx.yyyyy.zzzzz`

각 부분은 다음과 같이 구성된다.

- Header : 토큰 유형(JWT)과 사용 중인 서명 알고리즘(예: HMAC SHA256 또는 RSA)으로 구성된다.
- Payload : 등록, 공개 및 비공개 클레임의 세 가지 유형의 클레임( 엔티티(일반적으로 사용자)와 추가 데이터에 대한 진술 )이 포함되어 있다.
- Signature : 헤더와 페이로드를 각각 Base64Url 인코딩한 후, 이 둘을 점(.)으로 연결하고, 비밀 키를 사용해 서명 알고리즘(예: HMAC SHA256)으로 서명한 값이다.

인증에서 사용자가 자격 증명을 사용하여 로그인에 성공하면 JSON 웹 토큰이 반환된다. 토큰은 자격 증명이므로 보안 문제를 방지하기 위해 세심한 주의를 기울여야 한다. 일반적으로 토큰을 필요 이상으로 오래 보관해서는 안 되며, 보안이 취약하므로 민감한 세션 데이터를 브라우저 저장소에 저장해서는 안 된다.

\------

**JWT의 장단점**

**장점 :**

- 무상태성(Stateless): 서버는 JWT를 별도로 저장하지 않아도 된다. 클라이언트가 JWT를 포함해 요청하면 서버는 토큰의 서명을 검증하고 토큰에 포함된 정보를 사용해 사용자를 인증할 수 있다.
- 자체 포함(Self-contained): JWT 안에 사용자 정보, 권한, 만료 시간 등 필요한 모든 정보를 담을 수 있어, 별도의 세션 저장소 없이도 인증 상태를 유지할 수 있다.
- 확장성: 무상태 인증 방식이므로, 서버 간의 세션 공유나 분산 시스템에서도 쉽게 확장 가능하다.
- 경량성: JSON 형식으로 표현되므로, 네트워크 대역폭 사용량이 적고, 다양한 클라이언트(웹, 모바일 등)에서 쉽게 사용 가능하다.

**단점:**

- 토큰 관리: JWT는 클라이언트에 저장되기 때문에 XSS 공격에 취약할 수 있다. HttpOnly 쿠키 등으로 보안을 강화해야 한다.
- 토큰 무효화 어려움: JWT는 발급된 후 서버 측에서 상태를 관리하지 않기 때문에, 토큰을 강제로 무효화하기 어려워 만료 시간 관리가 중요하다.
- 토큰 크기: 서명과 페이로드를 모두 포함하기 때문에, 단순한 세션 ID에 비해 상대적으로 크다.

---

### **OAuth 인증 방식**

사용자 인증을 위한 기술 표준이다.  OAuth는 사용자 이름, 비밀번호 등의 실제 사용자 자격 증명을 공유하지 않고 한 서비스에서 다른 서비스로 권한 부여를 전달하기 위한 프로토콜이다. OAuth를 사용하면 사용자는 한 플랫폼에서 로그인한 다음 다른 플랫폼에서 작업을 수행하고 데이터를 볼 수 있는 권한을 부여받을 수 있다.

OAuth에서 애플리케이션 하나가 사용자의 자격 증명을 보내는 대신 다른 애플리케이션에 권한 부여 토큰을 보내 사용자에게 액세스 권한을 부여한다.

액세스 토큰을 사용하면 OAuth를 안전하게 사용할 수 있다. 액세스 토큰은 사용자 및 토큰이 의도한 리소스에 대한 정보를 포함하는 데이터 조각인데 토큰에는 데이터 공유에 대한 특정 규칙도 포함된다.

OAuth인증은 소비자와 서비스 제공자 사이에서 일어나는데 이 인증 과정은 다음과 같다.

1.  소비자가 서비스제공자에게 요청토큰을 요청한다.
2.  서비스제공자가 소비자에게 요청토큰을 발급해준다.
3.  소비자가 사용자를 서비스제공자로 이동시킨다. 여기서 사용자 인증이 수행된다.
4.  서비스제공자가 사용자를 소비자로 이동시킨다.
5.  소비자가 접근토큰을 요청한다.
6.  서비스제공자가 접근토큰을 발급한다.
7.  발급된 접근토큰을 이용하여 소비자에서 사용자 정보에 접근한다.

\------

**OAuth 장단점**

**장점:**

- 보안성 강화:  
  사용자가 비밀번호 등 민감한 정보를 제3자와 공유하지 않으므로, 자격 증명이 노출될 위험이 줄어든다.
- 유연한 권한 부여:  
  OAuth는 다양한 권한 부여 흐름(Authorization Code, Implicit, Resource Owner Password Credentials, Client Credentials)을 지원하여, 여러 상황에 맞게 적용할 수 있다.
- 표준화:  
  OAuth는 널리 채택된 표준 프로토콜로, 다양한 플랫폼과 언어에서 구현이 가능하며, 여러 서비스 간의 연동이 수월하다.

**단점:**

- 구현 복잡성:  
  OAuth는 설정 및 구현 과정이 복잡하여, 올바른 보안 설정과 토큰 관리를 위해 추가적인 노력이 필요하다.
- 토큰 관리 문제:  
  액세스 토큰 및 리프레시 토큰의 관리가 필요하며, 토큰 탈취 시 위험이 있으므로 적절한 보안 조치(예: TLS 사용, 토큰 만료 관리)가 필수적이다.

---

각 방식은 장단점이 있으므로 보안성과 사용성을 동시에 고려할 때 여러 조합으로 많이 사용된다. 먼저 일반적인 사용자 인증 플로우를 본다면 다음과 같다.

#### **전체적인 사용자 인증 플로우**

#### **1.1. 회원가입 (Sign-Up)**

- **사용자 입력:** 사용자가 회원가입 페이지에서 아이디, 이메일, 비밀번호 등의 정보를 입력.
- **서버 전송:** 입력 정보가 HTTPS를 통해 서버로 전송.
- **서버 처리:**
  - 서버는 입력된 데이터를 검증하고, 비밀번호는 안전한 해싱 알고리즘(bcrypt 등)을 통해 해시 처리하여 데이터베이스에 저장.
  - 가입 성공 시, 사용자에게 확인 메일을 보내거나 회원가입 완료 메시지를 제공.

#### **1.2. 로그인 (Sign-In)**

- **사용자 입력:** 사용자가 로그인 페이지에서 아이디(또는 이메일)와 비밀번호를 입력.
- **서버 전송:** HTTPS를 통해 로그인 정보를 서버에 전송.
- **서버 검증:**
  - 서버는 데이터베이스에서 해당 사용자의 정보를 조회하고, 입력한 비밀번호를 해싱하여 저장된 해시와 비교.
  - 인증 성공 시, 서버는 사용자를 위한 인증 토큰(예: JWT), 세션 또는 쿠키를 생성해 응답으로 전달.

#### **1.3. 이후 요청 처리**

- **상태 유지:**
  - 사용자가 인증에 성공하면, 이후의 HTTP 요청에 인증 정보를 함께 포함시켜 서버에 전달한다.
  - 이 과정에서 쿠키, 세션 ID, JWT 토큰 등이 사용된다.
- **인증 검증:**
  - 서버는 전달받은 인증 정보를 검증해 사용자가 인증된 상태인지 확인하고, 요청을 처리한다.

#### **조합 방식 추천**

서버 렌더링 기반의 웹 애플리케이 : 세션 기반 인증 + 쿠키

API 중심 애플리케이션 또는 분산 시스템 : JWT 기반 인증

소셜 로그인이나 제3자 애플리케이션 연동 : OAuth 인증 + JWT

혼합 환경 : 세션 기반 인증(로그인 상태를 관리) + JWT(API 요청을 인증)

---

**참고**

쿠키 :

HTTP 쿠키 - MDN

[https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies#%ED%95%A8%EA%BB%98\_%EC%B0%B8%EA%B3%A0%ED%95%A0\_%EB%82%B4%EC%9A%A9](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies#%ED%95%A8%EA%BB%98_%EC%B0%B8%EA%B3%A0%ED%95%A0_%EB%82%B4%EC%9A%A9)

HTTP 쿠키

[https://ko.wikipedia.org/wiki/HTTP\_%EC%BF%A0%ED%82%A4](https://ko.wikipedia.org/wiki/HTTP_%EC%BF%A0%ED%82%A4 'HTTP 쿠키에 대한 위키피디아')

HTTP cookies explained - human who codes

[https://humanwhocodes.com/blog/2009/05/05/http-cookies-explained/](https://humanwhocodes.com/blog/2009/05/05/http-cookies-explained/)

Understanding cookies - web.dev

[https://web.dev/articles/understanding-cookies](https://web.dev/articles/understanding-cookies)

세션 :

Session Management Cheat Sheet - owasp

[https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html)

쿠키,세션이란? - 블로그

[https://chrisjune-13837.medium.com/web-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98%EC%9D%B4%EB%9E%80-aa6bcb327582](https://chrisjune-13837.medium.com/web-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98%EC%9D%B4%EB%9E%80-aa6bcb327582)

express-session - Express

[https://expressjs.com/en/resources/middleware/session.html](https://expressjs.com/en/resources/middleware/session.html)

JWT:

JWT 공식 웹사이트

[https://jwt.io/introduction](https://jwt.io/introduction)

JSON Web Token Cheat Sheet for Java - owasp

[https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html)

Get Started with JSON Web Tokens - auth0

[https://auth0.com/learn/json-web-tokens](https://auth0.com/learn/json-web-tokens)

OAuth:

OAuth란? | SAML과 OAuth의 비교 - cloudflare

[https://www.cloudflare.com/ko-kr/learning/access-management/what-is-oauth/](https://www.cloudflare.com/ko-kr/learning/access-management/what-is-oauth/)

OAuth란? - microsoft

[https://www.microsoft.com/ko-kr/security/business/security-101/what-is-oauth](https://www.microsoft.com/ko-kr/security/business/security-101/what-is-oauth)

그 외 기타 블로그
