## Q4. DNS 조회 과정과 캐싱 메커니즘은 어떻게 동작하나요?

### 주요 키워드

- **DNS (Domain Name System)**: 도메인명을 IP 주소로 변환하는 시스템
- **재귀 조회 (Recursive Query)**: 완전한 답변을 받을 때까지 조회하는 방식
- **반복 조회 (Iterative Query)**: 각 단계별로 참조 정보를 받아가며 조회하는 방식
- **Root Name Server**: DNS 계층 구조의 최상위 서버
- **TTL (Time To Live)**: DNS 레코드의 캐시 유지 시간
- **DNS 레코드 타입**: A, AAAA, CNAME, MX, NS 등의 다양한 레코드 유형
- **DNS 캐시**: 조회 결과를 임시 저장하여 성능을 향상시키는 메커니즘

### Script

DNS 조회 과정은 **계층적 구조를 통해 도메인명을 IP 주소로 변환하는 과정**입니다.

**첫 번째로 로컬 캐시 확인**부터 시작됩니다. 브라우저 캐시, 운영체제 캐시, 로컬 DNS 캐시에서 해당 도메인의 IP 주소가 저장되어 있는지 확인합니다. 캐시에 있고 TTL이 유효하면 바로 해당 IP를 반환합니다.

**캐시에 없으면 재귀 조회가 시작됩니다.** 클라이언트는 설정된 DNS 서버(보통 ISP의 DNS 서버)에게 재귀 조회를 요청합니다. 이 DNS 서버가 클라이언트 대신 전체 조회 과정을 처리합니다.

**DNS 서버는 반복 조회를 수행합니다.** 먼저 Root Name Server에 질의하여 최상위 도메인(.com, .org 등)을 담당하는 TLD 서버 정보를 받습니다. 그다음 TLD 서버에 질의하여 해당 도메인을 담당하는 권한 있는 네임 서버(Authoritative Name Server) 정보를 받습니다.

**마지막으로 권한 있는 네임 서버**에서 최종 IP 주소를 조회하여 클라이언트에게 반환합니다.

**캐싱 메커니즘**은 성능 향상의 핵심입니다. 각 DNS 레코드는 TTL 값을 가지고 있어, 브라우저부터 각 단계의 DNS 서버까지 모든 레벨에서 TTL 시간만큼 결과를 캐싱합니다. 이로 인해 같은 도메인에 대한 반복 조회 시 응답 시간이 크게 단축됩니다.

---

## DNS 조회 과정과 캐싱

### 🔍 예상 꼬리 질문들

### Q4-1. "DNS 조회에서 재귀 조회와 반복 조회의 차이점을 설명해주세요"

**전문가 답변**:
**누가 조회 작업을 수행하느냐**의 차이입니다.

**재귀 조회 (Recursive Query)**:

- 클라이언트가 DNS 서버에게 **"최종 답을 찾아서 알려주세요"** 요청
- DNS 서버가 **모든 조회 작업을 대신 수행**
- 클라이언트는 한 번만 요청하고 최종 결과만 받음
- ISP의 DNS 서버가 클라이언트를 대신해서 전체 과정 처리

**반복 조회 (Iterative Query)**:

- DNS 서버 간에 **"내가 아는 건 이거야, 다음엔 여기로 가봐"** 방식
- 각 DNS 서버는 자신이 아는 정보만 제공하고 다음 단계 안내
- Root → TLD → Authoritative 순서로 단계별 안내

**실제 과정**:
클라이언트 → ISP DNS (재귀 조회 요청)
ISP DNS → Root, TLD, Authoritative (반복 조회 수행)
ISP DNS → 클라이언트 (최종 결과 응답)

---

### Q4-2. "TTL 값이 너무 짧으면 어떤 문제가 생기고, 너무 길면 어떤 문제가 생기나요?"

**전문가 답변**:
**캐싱 효율성과 업데이트 반영 속도**의 트레이드오프입니다.

**TTL이 너무 짧을 때 (예: 60초)**:

- **장점**: IP 변경 시 빠른 반영, 로드밸런싱 효과
- **단점**:
  - DNS 서버 부하 증가 (자주 조회)
  - 응답 시간 지연 (캐시 히트율 감소)
  - 네트워크 트래픽 증가

**TTL이 너무 길 때 (예: 86400초/24시간)**:

- **장점**: 캐시 효율성 극대화, DNS 서버 부하 감소
- **단점**:
  - 서버 장애 시 복구 지연
  - IP 변경 시 반영 지연 (최대 24시간)
  - CDN 전환 등 인프라 변경의 어려움

**적절한 TTL 설정**:

- **일반 웹사이트**: 3600초(1시간) ~ 14400초(4시간)
- **CDN/로드밸런서**: 300초(5분) ~ 3600초(1시간)
- **마이그레이션 준비**: 300초(5분) 이하로 미리 단축

---

### Q4-3. "DNS 캐시 포이즈닝 공격은 무엇이고 어떻게 방어하나요?"

**전문가 답변**:
**가짜 DNS 응답을 캐시에 저장시켜 사용자를 악성 사이트로 유도**하는 공격입니다.

**공격 원리**:

1. 공격자가 DNS 서버에 정상적인 질의를 보냄
2. 정상 응답보다 **먼저 가짜 응답을 전송**
3. DNS 서버가 가짜 응답을 진짜로 인식하여 캐시에 저장
4. 이후 같은 도메인 조회 시 가짜 IP 주소 반환
5. 사용자가 악성 사이트로 연결됨

**Dan Kaminsky 공격 (2008)**:

- Transaction ID와 포트 번호를 예측하여 성공률 대폭 증가
- DNS 응답 패킷의 **예측 가능한 값들을 악용**

**방어 방법**:

**1. DNSSEC (DNS Security Extensions)**:

- **디지털 서명**으로 DNS 응답의 무결성 검증
- 공개키 암호화 기반으로 변조 탐지

**2. DNS over HTTPS (DoH) / DNS over TLS (DoT)**:

- **암호화된 채널**로 DNS 질의/응답
- 중간자 공격 차단

**3. 랜덤화 강화**:

- Transaction ID, 포트 번호 완전 랜덤화
- Query Name Case Randomization (0x20 encoding)

**4. DNS 필터링**:

- 신뢰할 수 있는 Public DNS 사용 (Cloudflare 1.1.1.1, Google 8.8.8.8)
