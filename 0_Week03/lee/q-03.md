# 토픽: http, 프로토콜, 네트워크

[블로그 정리](https://yoolllog.tistory.com/49)

## Q. Cache-Control: max-age와 no-cache의 차이를 설명해 보세요.

### Cache-Control 헤더의 두 핵심 지시어

| 지시어             | 의미                                       | 캐시에 **보관**? | 재사용 전 **원 서버 확인**?           |
| ------------------ | ------------------------------------------ | ---------------- | ------------------------------------- |
| **`max-age=⟨초⟩`** | “이 응답은 ⟨초⟩ 동안 _신선(fresh)_ 하다.”  | O                | **신선 기간** 동안은 X, 만료 뒤에는 O |
| **`no-cache`**     | “보관은 해도 되지만, **매번** 재검증해라.” | O                | **항상** O (조건부 GET·HEAD)          |

### max-age

- 동작

  - 브라우저가 응답을 캐시에 저장하고 “만료 시각 = 수신 시각 + ⟨초⟩”를 기록.

  - 이후 요청이 만료 전이면 즉시 캐시에서 반환(네트워크 왕복 0).

  - 만료되면 If-None-Match(ETag) 또는 If-Modified-Since(Last-Modified) 헤더를 붙여 조건부 요청.

  - 서버가 304 Not Modified를 주면 캐시가 다시 신선해지고 본문은 내려오지 않는다.

- 용도

  - 이미지·CSS·JS 같이 자주 바뀌지 않는 정적 자원

  - /users/123처럼 변하지 않는 프로필 API(예: max-age=60)

### no-cache

- 동작

  - 응답을 저장은 하지만, 다시 쓰기 직전에 꼭 원 서버와 검증해야 한다.

  - 검증은 역시 ETag 또는 Last-Modified 기반 조건부 GET.

  - 검증 결과가 304면 본문 전달 없이 캐시된 사본을 사용, 200이면 새 사본으로 교체.

- 의도

  - 내용이 “변할 가능성은 높지만 변화가 없으면 대역폭을 아끼고 싶은” 자원.

  - 사용자별 개인화 HTML, 실시간 가격·재고 API 등.

  - 오류 페이지처럼 항상 최신을 보장해야 하지만 헤더만으로 변경 여부를 확인할 수 있는 경우.

### 무엇이 같고 무엇이 다른가?

| 관점                 | `max-age`                 | `no-cache`              |
| -------------------- | ------------------------- | ----------------------- |
| **저장 여부**        | 저장 O                    | 저장 O                  |
| **네트워크 왕복**    | 신선 기간엔 0             | 항상 1(조건부)          |
| **변경 전파 속도**   | 신선 기간만큼 _지연_ 가능 | 거의 즉시(검증 성공 시) |
| **트래픽 절감 효과** | 크다                      | 헤더만큼(본문은 절감)   |
| **오프라인 사용**    | 기간 내 동작              | 불가(검증 실패)         |

### 혼동하기 쉬운 지시어: no-store

- no-store 는 절대 저장 금지. 브라우저도 프록시도 한 바이트도 남기지 않는다.

- 결제 정보, 개인 건강 데이터처럼 캐시에 남는 것 자체가 위험할 때 사용.

### 실무 예시

```http
# 완전히 버전 고정된 JS 번들
Cache-Control: public, max-age=31536000, immutable

# 사용자 대시보드 HTML
Cache-Control: private, no-cache, must-revalidate
ETag: "a1b2c3"

# OAuth 토큰 응답
Cache-Control: no-store, max-age=0
```

- 정적 번들은 1년 동안 신선하게 두고, 파일 이름(해시)이 바뀌면 새로 받는다.

- 대시보드는 매 로드 시 ETag 검증으로 변경 여부를 확인해 최신 데이터를 보장한다.

- 토큰은 보안상 저장 자체를 막는다.

### 요약

```
max-age : “지정된 시간 동안은 그대로 써도 돼.” (완전한 오프라인 캐싱 가능)

no-cache : “써도 되지만 항상 서버에 물어보고 써.” (항상 조건부 재검증)
```

---

### 꼬리질문

#### Q. ETag 기반 조건부 요청이 일어나는 과정을 단계별로 설명해 보세요.

#### Q. CDN의 stale-while-revalidate 지시어를 이용해 JS 번들을 안전하게 업데이트하는 방안을 제안해 보세요.
